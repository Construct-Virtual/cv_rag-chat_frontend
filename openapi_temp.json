{"openapi":"3.1.0","info":{"title":"SOP AI Agent Chat API","description":"RAG-powered chat interface for querying Standard Operating Procedures","version":"1.0.0"},"paths":{"/":{"get":{"summary":"Root","description":"Root endpoint","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health":{"get":{"summary":"Health Check","description":"Health check endpoint","operationId":"health_check_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health/db":{"get":{"summary":"Database Health","description":"Database health check endpoint","operationId":"database_health_api_health_db_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate user and return JWT tokens\n\n- Validates credentials against database\n- Updates last_login timestamp\n- Returns access token and refresh token (set in httpOnly cookie)","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/logout":{"post":{"tags":["auth"],"summary":"Logout","description":"Logout user and invalidate tokens\n\n- Clears refresh token cookie\n- Invalidates refresh token in database","operationId":"logout_api_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/test/clear-refresh-tokens":{"post":{"tags":["auth"],"summary":"Clear Refresh Tokens","description":"Test endpoint to clear all refresh tokens","operationId":"clear_refresh_tokens_api_auth_test_clear_refresh_tokens_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/refresh":{"post":{"tags":["auth"],"summary":"Refresh Token","description":"Refresh access token using refresh token\n\n- Reads refresh token from httpOnly cookie\n- Validates refresh token\n- Issues new access token\n- Returns new access token","operationId":"refresh_token_api_auth_refresh_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Get Me","description":"Get current user information\n\n- Requires valid access token\n- Returns user profile data","operationId":"get_me_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chat/conversations":{"get":{"tags":["chat"],"summary":"Get Conversations","description":"Get all conversations for current user\n\n- Requires valid access token\n- Returns list of conversations sorted by updated_at (newest first)\n- Includes last message preview and timestamp","operationId":"get_conversations_api_chat_conversations_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/ConversationResponse"},"type":"array","title":"Response Get Conversations Api Chat Conversations Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["chat"],"summary":"Create Conversation","description":"Create a new conversation\n\n- Requires valid access token\n- Creates conversation with optional custom title\n- Returns conversation details","operationId":"create_conversation_api_chat_conversations_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chat/conversations/{conversation_id}":{"get":{"tags":["chat"],"summary":"Get Conversation","description":"Get a specific conversation\n\n- Requires valid access token\n- Verifies user owns the conversation\n- Returns conversation details","operationId":"get_conversation_api_chat_conversations__conversation_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["chat"],"summary":"Update Conversation","description":"Update a conversation (e.g., rename)\n\n- Requires valid access token\n- Verifies user owns the conversation\n- Updates conversation fields","operationId":"update_conversation_api_chat_conversations__conversation_id__patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["chat"],"summary":"Delete Conversation","description":"Delete a conversation and all its messages\n\n- Requires valid access token\n- Verifies user owns the conversation\n- Deletes conversation and associated messages","operationId":"delete_conversation_api_chat_conversations__conversation_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat/conversations/{conversation_id}/messages":{"get":{"tags":["chat"],"summary":"Get Messages","description":"Get all messages in a conversation\n\n- Requires valid access token\n- Verifies user owns the conversation\n- Returns messages sorted by created_at (oldest first)","operationId":"get_messages_api_chat_conversations__conversation_id__messages_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MessageResponse"},"title":"Response Get Messages Api Chat Conversations  Conversation Id  Messages Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat/query":{"post":{"tags":["chat"],"summary":"Chat Query","description":"Send a message and receive a streaming AI response with RAG\n\n- Requires valid access token\n- Verifies user owns the conversation\n- Saves user message to database\n- Performs RAG retrieval with role-based filtering\n- Streams AI response using Server-Sent Events (SSE)\n- Includes source citations in response\n- Saves AI response to database when complete","operationId":"chat_query_api_chat_query_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chat/conversations/{conversation_id}/share":{"post":{"tags":["chat"],"summary":"Share Conversation","description":"Enable sharing for a conversation\n\n- Requires valid access token\n- User must own the conversation\n- Generates unique share_token\n- Sets is_shared to true\n- Returns updated conversation with share_token","operationId":"share_conversation_api_chat_conversations__conversation_id__share_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["chat"],"summary":"Unshare Conversation","description":"Disable sharing for a conversation\n\n- Requires valid access token\n- User must own the conversation\n- Removes share_token\n- Sets is_shared to false","operationId":"unshare_conversation_api_chat_conversations__conversation_id__share_delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat/shared/{share_token}":{"get":{"tags":["chat"],"summary":"Get Shared Conversation","description":"Get a shared conversation by share token (public endpoint)\n\n- No authentication required\n- Returns conversation if share_token is valid and is_shared is true\n- Used for viewing shared conversations","operationId":"get_shared_conversation_api_chat_shared__share_token__get","parameters":[{"name":"share_token","in":"path","required":true,"schema":{"type":"string","title":"Share Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat/shared/{share_token}/messages":{"get":{"tags":["chat"],"summary":"Get Shared Conversation Messages","description":"Get messages from a shared conversation (public endpoint)\n\n- No authentication required\n- Returns messages if share_token is valid and is_shared is true","operationId":"get_shared_conversation_messages_api_chat_shared__share_token__messages_get","parameters":[{"name":"share_token","in":"path","required":true,"schema":{"type":"string","title":"Share Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MessageResponse"},"title":"Response Get Shared Conversation Messages Api Chat Shared  Share Token  Messages Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"ConversationCreate":{"properties":{"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"}},"type":"object","title":"ConversationCreate","description":"Request model for creating a new conversation"},"ConversationResponse":{"properties":{"id":{"type":"string","title":"Id"},"user_id":{"type":"string","title":"User Id"},"title":{"type":"string","title":"Title"},"created_at":{"type":"string","title":"Created At"},"updated_at":{"type":"string","title":"Updated At"},"message_count":{"type":"integer","title":"Message Count","default":0},"last_message_preview":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Message Preview"},"last_message_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Message At"},"is_shared":{"type":"boolean","title":"Is Shared","default":false},"share_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Share Token"}},"type":"object","required":["id","user_id","title","created_at","updated_at"],"title":"ConversationResponse","description":"Response model for conversation"},"ConversationUpdate":{"properties":{"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"}},"type":"object","title":"ConversationUpdate","description":"Request model for updating conversation"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"}},"type":"object","required":["username","password"],"title":"LoginRequest","description":"Login request payload"},"MessageResponse":{"properties":{"id":{"type":"string","title":"Id"},"conversation_id":{"type":"string","title":"Conversation Id"},"role":{"type":"string","title":"Role"},"content":{"type":"string","title":"Content"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["id","conversation_id","role","content","created_at"],"title":"MessageResponse","description":"Response model for message"},"QueryRequest":{"properties":{"conversation_id":{"type":"string","title":"Conversation Id"},"message":{"type":"string","title":"Message"}},"type":"object","required":["conversation_id","message"],"title":"QueryRequest","description":"Request model for chat query"},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"},"user":{"$ref":"#/components/schemas/UserResponse"}},"type":"object","required":["access_token","refresh_token","user"],"title":"TokenResponse","description":"Authentication token response"},"UserResponse":{"properties":{"id":{"type":"string","title":"Id"},"username":{"type":"string","title":"Username"},"full_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Full Name"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"role":{"type":"string","title":"Role"},"last_login":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Login"},"avatar_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Avatar Url"}},"type":"object","required":["id","username","role"],"title":"UserResponse","description":"User information response"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}